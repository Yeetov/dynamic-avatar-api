<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- NUCLEAR CACHE BUSTING -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>AvatarAPI | Dynamic Game Assets</title>
    <meta name="description" content="The easiest way to display dynamic Minecraft, Overwatch, Roblox, Chess.com, GitHub, and Steam avatars.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;800&family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #3b82f6;
            --secondary: #a855f7;
            --bg-deep: #020617;
            --bg-plate: #0f172a;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-deep); 
            color: #f8fafc;
            overflow-x: hidden;
            perspective: 2000px;
        }

        /* --- TECTONIC PLATES ANIMATION --- */
        .tectonic-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -10;
            overflow: hidden;
            pointer-events: none;
        }

        .plate {
            position: absolute;
            background: var(--bg-plate);
            opacity: 0.4;
            transform-origin: center;
            border: 1px solid rgba(255,255,255,0.03);
        }

        .plate-1 {
            width: 150vw;
            height: 80vh;
            top: -20%;
            left: -20%;
            transform: rotate(-5deg);
            animation: tectonic-1 60s infinite ease-in-out alternate;
        }

        .plate-2 {
            width: 150vw;
            height: 100vh;
            top: 60%;
            left: -10%;
            transform: rotate(10deg);
            animation: tectonic-2 70s infinite ease-in-out alternate;
        }

        .plate-3 {
            width: 50vw;
            height: 50vh;
            top: 20%;
            right: -10%;
            background: radial-gradient(circle at center, #1e293b 0%, transparent 70%);
            opacity: 0.2;
            animation: float-slow 40s infinite linear;
        }

        @keyframes tectonic-1 {
            0% { transform: rotate(-5deg) translate(0, 0); }
            100% { transform: rotate(-4deg) translate(20px, 10px); }
        }

        @keyframes tectonic-2 {
            0% { transform: rotate(10deg) translate(0, 0); }
            100% { transform: rotate(8deg) translate(-20px, -10px); }
        }

        @keyframes float-slow {
            0% { transform: translate(0, 0); }
            50% { transform: translate(-30px, 20px); }
            100% { transform: translate(0, 0); }
        }

        /* --- LINE TRANSITIONS --- */
        .line-separator {
            width: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.5), transparent);
            margin: 0 auto;
            animation: line-expand 1.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        @keyframes line-expand {
            0% { width: 0; opacity: 0; }
            100% { width: 100%; opacity: 1; }
        }

        /* --- UI ELEMENTS --- */
        .glass-clean {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .code-block {
            font-family: 'JetBrains Mono', monospace;
            background: #0b101b;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* --- 3D ROTATING CUBE --- */
        .cube-scene { width: 40px; height: 40px; perspective: 600px; }
        .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; animation: spin-cube 20s infinite linear; }
        .cube-face {
            position: absolute; width: 40px; height: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(59, 130, 246, 0.05);
        }
        .cube-face:nth-child(1) { transform: rotateY(  0deg) translateZ(20px); }
        .cube-face:nth-child(2) { transform: rotateY( 90deg) translateZ(20px); }
        .cube-face:nth-child(3) { transform: rotateY(180deg) translateZ(20px); }
        .cube-face:nth-child(4) { transform: rotateY(-90deg) translateZ(20px); }
        .cube-face:nth-child(5) { transform: rotateX( 90deg) translateZ(20px); }
        .cube-face:nth-child(6) { transform: rotateX(-90deg) translateZ(20px); }
        @keyframes spin-cube { 0% { transform: rotateX(0deg) rotateY(0deg); } 100% { transform: rotateX(360deg) rotateY(360deg); } }

        /* --- UTILS --- */
        .animate-entrance { opacity: 0; animation: entrance-up 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        @keyframes entrance-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }
        .delay-500 { animation-delay: 0.5s; }

        .pixelated { image-rendering: pixelated; }
        .smooth { image-rendering: auto; }
        
        /* Game Button Clean Style */
        .game-btn { transition: all 0.2s ease; border-bottom: 2px solid transparent; opacity: 0.6; position: relative; overflow: hidden; }
        .game-btn:hover { opacity: 1; background: rgba(255,255,255,0.05); }
        .game-btn.active { opacity: 1; border-color: #3b82f6; background: linear-gradient(to bottom, transparent, rgba(59, 130, 246, 0.1)); color: white; }
        
        /* Loading Overlay Fade */
        .fade-exit { opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        
        /* Intro Fade Out */
        #intro-layer {
            position: fixed; inset: 0; background: #020617; z-index: 100;
            display: flex; justify-content: center; align-items: center;
            animation: fade-out 0.5s ease-in-out 1.2s forwards;
            pointer-events: none;
        }
        @keyframes fade-out { 0% { opacity: 1; } 100% { opacity: 0; } }
    </style>
</head>
<body class="min-h-screen flex flex-col relative selection:bg-blue-500/30 overflow-x-hidden">

    <!-- TECTONIC BACKGROUND -->
    <div class="tectonic-layer">
        <div class="plate plate-1"></div>
        <div class="plate plate-2"></div>
        <div class="plate plate-3"></div>
        <div class="absolute inset-0 opacity-10" style="background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px); background-size: 100px 100px;"></div>
    </div>

    <!-- INTRO -->
    <div id="intro-layer">
        <div class="flex flex-col items-center gap-4">
            <div class="w-16 h-16 border-t-2 border-l-2 border-blue-500 rounded-full animate-spin"></div>
            <div class="font-mono text-xs text-blue-400 tracking-[0.3em]">INITIALIZING</div>
        </div>
    </div>

    <!-- NAVBAR -->
    <nav class="relative z-50 w-full max-w-7xl mx-auto px-6 py-8 flex justify-between items-center animate-entrance">
        <div class="flex items-center gap-4">
            <div class="cube-scene">
                <div class="cube">
                    <div class="cube-face"></div>
                    <div class="cube-face"></div>
                    <div class="cube-face"></div>
                    <div class="cube-face"></div>
                    <div class="cube-face"></div>
                    <div class="cube-face"></div>
                </div>
            </div>
            <span class="font-bold text-xl tracking-tight text-white">Avatar<span class="font-light text-slate-500">API</span></span>
        </div>
        <div class="flex gap-6 text-xs font-bold tracking-widest text-slate-500 uppercase">
            <a href="#demo" class="hover:text-white transition-colors">Generator</a>
            <a href="#integration" class="hover:text-white transition-colors">Docs</a>
        </div>
    </nav>

    <!-- HERO -->
    <main class="relative z-10 w-full max-w-6xl mx-auto px-4 pt-16 pb-32 flex flex-col items-center text-center">
        
        <div class="animate-entrance delay-100 mb-8">
            <span class="inline-block px-3 py-1 bg-blue-900/30 border border-blue-500/30 rounded-full text-[10px] font-bold text-blue-400 tracking-widest uppercase">
                v3.0 Stable
            </span>
        </div>

        <h1 class="animate-entrance delay-200 text-6xl md:text-8xl font-black tracking-tighter mb-6 text-white leading-tight">
            Universal<br>
            <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">Game Assets</span>
        </h1>
        
        <div class="animate-entrance delay-300 w-full max-w-2xl mb-16 relative">
            <div class="line-separator mb-6 opacity-30"></div>
            <p class="text-lg text-slate-400 font-light leading-relaxed">
                The definitive API for dynamic avatars. 
                Zero config. Infinite updates.
                Supports <span class="text-white">Minecraft, Overwatch, Roblox, Steam, Chess, & GitHub</span>.
            </p>
        </div>

        <!-- MAIN INTERFACE -->
        <div id="demo" class="w-full relative animate-entrance delay-500">
            <div class="glass-clean rounded-2xl overflow-hidden border border-white/10 shadow-2xl">
                
                <!-- TABS -->
                <div class="flex overflow-x-auto bg-black/20 backdrop-blur-md border-b border-white/5 no-scrollbar">
                    <button onclick="switchGame('minecraft')" id="btn-minecraft" class="game-btn active flex-1 min-w-[100px] py-5 text-xs font-bold uppercase tracking-wider flex justify-center gap-2">
                        <i class="fas fa-cube"></i> Minecraft
                    </button>
                    <button onclick="switchGame('overwatch')" id="btn-overwatch" class="game-btn flex-1 min-w-[100px] py-5 text-xs font-bold uppercase tracking-wider flex justify-center gap-2">
                        <i class="fab fa-battle-net"></i> Overwatch
                    </button>
                    <button onclick="switchGame('roblox')" id="btn-roblox" class="game-btn flex-1 min-w-[100px] py-5 text-xs font-bold uppercase tracking-wider flex justify-center gap-2">
                        <i class="fas fa-shapes"></i> Roblox
                    </button>
                    <button onclick="switchGame('steam')" id="btn-steam" class="game-btn flex-1 min-w-[100px] py-5 text-xs font-bold uppercase tracking-wider flex justify-center gap-2">
                        <i class="fab fa-steam"></i> Steam
                    </button>
                    <button onclick="switchGame('chess')" id="btn-chess" class="game-btn flex-1 min-w-[100px] py-5 text-xs font-bold uppercase tracking-wider flex justify-center gap-2">
                        <i class="fas fa-chess-knight"></i> Chess
                    </button>
                    <button onclick="switchGame('github')" id="btn-github" class="game-btn flex-1 min-w-[100px] py-5 text-xs font-bold uppercase tracking-wider flex justify-center gap-2">
                        <i class="fab fa-github"></i> GitHub
                    </button>
                </div>

                <div class="p-8 md:p-16 flex flex-col md:flex-row gap-12 items-center md:items-start text-left">
                    
                    <!-- PREVIEW -->
                    <div class="flex flex-col items-center gap-6 w-full md:w-auto">
                        <div class="relative w-64 h-64 bg-slate-900 rounded-xl border border-white/10 flex items-center justify-center shadow-2xl overflow-hidden group">
                            <!-- Subtle Grid -->
                            <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(rgba(255,255,255,0.2) 1px, transparent 1px); background-size: 20px 20px;"></div>
                            
                            <img id="avatarPreview" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" 
                                class="w-full h-full object-contain z-10 relative pixelated transition-transform duration-500 group-hover:scale-105" alt="Preview">
                            
                            <div id="imgLoader" class="absolute inset-0 flex items-center justify-center bg-slate-900/90 hidden z-20 backdrop-blur-sm">
                                <div class="w-8 h-8 border-2 border-white/20 border-t-white rounded-full animate-spin"></div>
                            </div>
                        </div>
                        <a id="downloadLinkBtn" href="#" download class="text-[10px] font-bold uppercase tracking-widest text-slate-500 hover:text-white transition-colors pointer-events-none opacity-50 flex items-center gap-2">
                            <i class="fas fa-download"></i> Download PNG
                        </a>
                    </div>

                    <!-- CONTROLS -->
                    <div class="flex-grow w-full space-y-8">
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="md:col-span-2 space-y-2">
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest ml-1">Identity</label>
                                <input type="text" id="usernameInput" 
                                    class="w-full bg-slate-950/50 border border-slate-800 focus:border-blue-500/50 text-white rounded-lg py-4 px-5 outline-none transition-all placeholder-slate-700 font-medium font-mono"
                                    placeholder="Username" autocomplete="off"
                                    onkeydown="if(event.key === 'Enter') fetchAvatar()">
                            </div>
                            <div class="space-y-2 relative">
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest ml-1">Resolution</label>
                                <input type="number" id="sizeInput" value="256" min="32" max="2048"
                                    class="w-full bg-slate-950/50 border border-slate-800 focus:border-blue-500/50 text-white rounded-lg py-4 px-5 outline-none transition-all text-center font-mono"
                                    onkeydown="if(event.key === 'Enter') fetchAvatar()">
                            </div>
                        </div>

                        <button onclick="fetchAvatar()" class="w-full bg-white text-black hover:bg-blue-50 font-bold py-4 rounded-lg shadow-lg shadow-white/5 transition-all flex items-center justify-center gap-3 uppercase tracking-wider text-sm active:scale-[0.99]">
                            <i class="fas fa-bolt text-blue-600"></i> Generate Asset
                        </button>

                        <!-- CODE OUTPUT -->
                        <div class="pt-6 border-t border-white/5 relative">
                            <div class="flex justify-between items-end mb-3">
                                <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Integration Link</label>
                                <div class="flex bg-slate-900 rounded p-1 border border-slate-800">
                                    <button onclick="setFormat('url')" class="fmt-btn active px-3 py-1 text-[10px] font-bold rounded text-slate-400 hover:text-white transition-colors">URL</button>
                                    <button onclick="setFormat('html')" class="fmt-btn px-3 py-1 text-[10px] font-bold rounded text-slate-400 hover:text-white transition-colors">HTML</button>
                                    <button onclick="setFormat('md')" class="fmt-btn px-3 py-1 text-[10px] font-bold rounded text-slate-400 hover:text-white transition-colors">MD</button>
                                </div>
                            </div>
                            
                            <div class="relative group">
                                <input type="text" id="apiLinkInput" readonly 
                                    class="w-full bg-slate-950 border border-slate-800 text-blue-400 font-mono text-xs rounded-lg p-4 pr-24 outline-none select-all transition-colors hover:border-slate-700"
                                    value="// Ready">
                                
                                <button onclick="copyLink()" class="absolute right-2 top-2 bottom-2 px-4 bg-slate-900 hover:bg-slate-800 text-slate-300 rounded border border-slate-800 transition-colors text-[10px] font-bold uppercase tracking-widest">
                                    Copy
                                </button>
                            </div>

                            <div id="statusContainer" class="hidden mt-4 text-red-400 text-xs bg-red-950/30 border border-red-500/20 p-4 rounded-lg flex items-center gap-3">
                                <i class="fas fa-circle-xmark"></i> <span id="statusText">Error</span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- INTEGRATION DOCS -->
    <section id="integration" class="relative z-10 w-full max-w-6xl mx-auto px-6 pb-32 animate-entrance delay-500">
        <div class="flex items-center justify-center gap-4 mb-16 opacity-50">
            <div class="h-px bg-white/20 w-24"></div>
            <h2 class="text-xs font-bold uppercase tracking-[0.2em] text-white">Developer Resources</h2>
            <div class="h-px bg-white/20 w-24"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Card 1 -->
            <div class="glass-clean p-8 rounded-xl hover:border-blue-500/30 transition-colors group">
                <div class="flex items-center gap-4 mb-6">
                    <i class="fab fa-html5 text-2xl text-orange-500"></i>
                    <h3 class="font-bold text-white text-sm uppercase tracking-wide">HTML</h3>
                </div>
                <div class="relative">
                    <code id="code-html" class="code-block block p-4 rounded-lg text-[10px] text-slate-400 overflow-x-auto">
                        &lt;img src="<span class="text-green-400">https://dynamicavatarapi.vercel.app/api/minecraft/face?user=Grian</span>" /&gt;
                    </code>
                    <button onclick="copyCode(this)" class="absolute top-2 right-2 p-1.5 bg-slate-800 hover:bg-slate-700 rounded text-slate-400 hover:text-white transition-colors opacity-0 group-hover:opacity-100">
                        <i class="far fa-copy text-xs"></i>
                    </button>
                </div>
            </div>

            <!-- Card 2 -->
            <div class="glass-clean p-8 rounded-xl hover:border-blue-500/30 transition-colors group">
                <div class="flex items-center gap-4 mb-6">
                    <i class="fab fa-react text-2xl text-blue-500"></i>
                    <h3 class="font-bold text-white text-sm uppercase tracking-wide">React</h3>
                </div>
                <div class="relative">
                    <code id="code-react" class="code-block block p-4 rounded-lg text-[10px] text-slate-400 overflow-x-auto">
                        &lt;Avatar src={`<span class="text-blue-400">https://dynamicavatarapi.vercel.app/api/minecraft/face?user=Grian</span>`} /&gt;
                    </code>
                    <button onclick="copyCode(this)" class="absolute top-2 right-2 p-1.5 bg-slate-800 hover:bg-slate-700 rounded text-slate-400 hover:text-white transition-colors opacity-0 group-hover:opacity-100">
                        <i class="far fa-copy text-xs"></i>
                    </button>
                </div>
            </div>

            <!-- Card 3 -->
            <div class="glass-clean p-8 rounded-xl hover:border-blue-500/30 transition-colors group">
                <div class="flex items-center gap-4 mb-6">
                    <i class="fab fa-markdown text-2xl text-purple-500"></i>
                    <h3 class="font-bold text-white text-sm uppercase tracking-wide">Markdown</h3>
                </div>
                <div class="relative">
                    <code id="code-md" class="code-block block p-4 rounded-lg text-[10px] text-slate-400 overflow-x-auto">
                        ![User](<span class="text-purple-400">https://dynamicavatarapi.vercel.app/api/minecraft/face?user=Grian</span>)
                    </code>
                    <button onclick="copyCode(this)" class="absolute top-2 right-2 p-1.5 bg-slate-800 hover:bg-slate-700 rounded text-slate-400 hover:text-white transition-colors opacity-0 group-hover:opacity-100">
                        <i class="far fa-copy text-xs"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="border-t border-white/5 bg-black/20 py-12 relative z-10 backdrop-blur-md">
        <div class="max-w-6xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="text-slate-600 text-xs font-mono">
                &copy; 2025-<span id="currentYear"></span> AvatarAPI.
            </div>
            <div class="text-slate-700 text-[10px] uppercase tracking-widest font-bold">
                System Operational
            </div>
        </div>
    </footer>

    <script>
        // --- CONFIG ---
        const PRODUCTION_URL = 'https://dynamicavatarapi.vercel.app';
        document.getElementById('currentYear').innerText = new Date().getFullYear();

        let currentGame = 'minecraft';
        let currentUrl = '';
        let currentFormat = 'url';
        
        // --- STATE MANAGEMENT (SMART AUTOSWITCH) ---
        // Default structure
        const defaultState = {
            minecraft: { user: '', size: '256' },
            overwatch: { user: '', size: '128' },
            roblox: { user: '', size: '256' },
            steam: { user: '', size: '184' },
            chess: { user: '', size: '256' },
            github: { user: '', size: '256' }
        };

        // Load or init
        let gameData = JSON.parse(localStorage.getItem('avatarApiState')) || defaultState;

        function saveState() {
            localStorage.setItem('avatarApiState', JSON.stringify(gameData));
        }

        // --- CORE LOGIC ---
        const input = document.getElementById('usernameInput');
        const sizeInput = document.getElementById('sizeInput');

        // Update state on typing
        input.addEventListener('input', (e) => {
            gameData[currentGame].user = e.target.value.trim();
            saveState();
        });

        sizeInput.addEventListener('input', (e) => {
            gameData[currentGame].size = e.target.value;
            saveState();
        });

        // Use production URL for snippets
        const displayBaseUrl = PRODUCTION_URL;

        function switchGame(game) {
            // 1. Save current (already done via input listener, but double check)
            
            // 2. Switch
            currentGame = game;
            
            document.querySelectorAll('.game-btn').forEach(b => {
                b.classList.remove('active', 'bg-white', 'text-black');
                b.classList.add('text-slate-500');
            });
            
            const activeBtn = document.getElementById(`btn-${game}`);
            activeBtn.classList.add('active', 'bg-white', 'text-black');
            activeBtn.classList.remove('text-slate-500');

            const img = document.getElementById('avatarPreview');

            // 3. Set Context (Placeholders/Limits)
            let maxSize = 2048;
            let placeholder = "Username";

            if (game === 'minecraft') {
                placeholder = "e.g. Grian";
                img.classList.remove('smooth'); img.classList.add('pixelated');
            } else if (game === 'overwatch') {
                placeholder = "e.g. Name#1234";
                img.classList.remove('pixelated'); img.classList.add('smooth');
                maxSize = 128; 
            } else if (game === 'roblox') {
                placeholder = "e.g. Roblox";
                img.classList.remove('pixelated'); img.classList.add('smooth');
            } else if (game === 'chess') {
                placeholder = "e.g. MagnusCarlsen";
                img.classList.remove('pixelated'); img.classList.add('smooth');
            } else if (game === 'github') {
                placeholder = "e.g. torvalds";
                img.classList.remove('pixelated'); img.classList.add('smooth');
            } else if (game === 'steam') {
                placeholder = "e.g. gabelogannewell or ID";
                img.classList.remove('pixelated'); img.classList.add('smooth');
                maxSize = 184;
            }
            
            input.placeholder = placeholder;
            sizeInput.max = maxSize;

            // 4. RESTORE DATA
            const savedUser = gameData[game].user || '';
            const savedSize = gameData[game].size || (maxSize < 256 ? maxSize : '256');

            input.value = savedUser;
            sizeInput.value = savedSize;

            // 5. AUTO-FETCH if data exists
            if (savedUser) {
                fetchAvatar();
            } else {
                resetOutput();
            }
        }

        function setFormat(fmt) {
            currentFormat = fmt;
            document.querySelectorAll('.fmt-btn').forEach(b => {
                b.classList.remove('active', 'bg-white', 'text-black');
                b.classList.add('text-slate-400');
            });
            event.target.classList.add('active', 'bg-white', 'text-black');
            event.target.classList.remove('text-slate-400');
            updateOutputText();
        }

        function resetOutput() {
            document.getElementById('apiLinkInput').value = '// Ready';
            document.getElementById('statusContainer').classList.add('hidden');
            document.getElementById('avatarPreview').src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";
            disableActions(true);
            currentUrl = '';
            // Reset snippets to generic
            updateIntegrationSnippets(null, null);
        }

        async function fetchAvatar() {
            const username = input.value.trim();
            const size = sizeInput.value.trim() || '256';

            if (!username) return;

            document.getElementById('statusContainer').classList.add('hidden');
            document.getElementById('imgLoader').classList.remove('hidden');
            const img = document.getElementById('avatarPreview');
            img.style.opacity = '0.3';

            let endpoint = '';
            if (currentGame === 'minecraft') endpoint = '/api/minecraft/face';
            else if (currentGame === 'overwatch') endpoint = '/api/overwatch/icon';
            else if (currentGame === 'roblox') endpoint = '/api/roblox/avatar';
            else if (currentGame === 'chess') endpoint = '/api/chess/avatar';
            else if (currentGame === 'github') endpoint = '/api/github/avatar';
            else if (currentGame === 'steam') endpoint = '/api/steam/avatar';

            // Internal URL for preview (relative)
            const previewUrl = `${endpoint}?user=${encodeURIComponent(username)}&size=${size}`;
            // External URL for user to copy (absolute)
            const publicUrl = `${displayBaseUrl}${endpoint}?user=${encodeURIComponent(username)}&size=${size}`;
            
            currentUrl = publicUrl; 
            updateOutputText();
            updateIntegrationSnippets(publicUrl, username);

            const cacheBuster = `&t=${Date.now()}`;
            const displayUrl = previewUrl + cacheBuster;
            
            const tempImg = new Image();
            tempImg.src = displayUrl;

            tempImg.onload = function() {
                img.src = displayUrl;
                img.style.opacity = '1';
                document.getElementById('imgLoader').classList.add('hidden');
                
                const dlBtn = document.getElementById('downloadLinkBtn');
                dlBtn.href = displayUrl;
                dlBtn.download = `${username}_avatar.png`;
                dlBtn.classList.remove('opacity-50', 'pointer-events-none');
                
                disableActions(false);
            };

            tempImg.onerror = function() {
                img.style.opacity = '1';
                document.getElementById('imgLoader').classList.add('hidden');
                let msg = "User not found";
                if (currentGame === 'overwatch') msg = "Player not found. Try 'Name-1234' format.";
                else if (currentGame === 'roblox') msg = "Roblox user not found.";
                else if (currentGame === 'steam') msg = "Steam profile not found.";
                
                showError(msg);
                disableActions(true);
                currentUrl = ''; 
                document.getElementById('apiLinkInput').value = '// Error: ' + msg;
            };
        }

        function updateIntegrationSnippets(url, username) {
            const cleanUrl = url || `${displayBaseUrl}/api/minecraft/face?user=Grian`;
            const safeUser = username || 'Grian';

            document.getElementById('code-html').innerHTML = 
                `&lt;img src="<span class="text-green-400">${cleanUrl}</span>" /&gt;`;

            document.getElementById('code-react').innerHTML = 
                `&lt;Avatar src={<span class="text-blue-400">"${cleanUrl}"</span>} /&gt;`;

            document.getElementById('code-md').innerHTML = 
                `![${safeUser}](<span class="text-purple-400">${cleanUrl}</span>)`;
        }

        // Init
        // Restore Minecraft state on load if it exists
        if (gameData['minecraft'].user) {
            input.value = gameData['minecraft'].user;
            sizeInput.value = gameData['minecraft'].size;
            fetchAvatar();
        } else {
            updateIntegrationSnippets(null, null);
        }

        function updateOutputText() {
            if (!currentUrl) return;
            const input = document.getElementById('apiLinkInput');
            if (currentFormat === 'url') input.value = currentUrl;
            else if (currentFormat === 'html') input.value = `<img src="${currentUrl}" alt="Avatar" />`;
            else if (currentFormat === 'md') input.value = `![Avatar](${currentUrl})`;
        }

        function showError(msg) {
            const el = document.getElementById('statusContainer');
            document.getElementById('statusText').innerText = msg;
            el.classList.remove('hidden');
        }

        function disableActions(disable) {
            const el = document.getElementById('downloadLinkBtn');
            if(disable) {
                el.classList.add('pointer-events-none', 'opacity-50');
            } else {
                el.classList.remove('pointer-events-none', 'opacity-50');
            }
        }

        function copyLink() {
            const copyText = document.getElementById("apiLinkInput");
            if (copyText.value.startsWith('//')) return;
            copyText.select();
            document.execCommand("copy");
            const btn = copyText.nextElementSibling;
            const originalText = btn.innerText;
            btn.innerText = 'COPIED';
            btn.classList.add('bg-white', 'text-black');
            btn.classList.remove('bg-slate-900', 'text-slate-300');
            setTimeout(() => { 
                btn.innerText = originalText; 
                btn.classList.remove('bg-white', 'text-black');
                btn.classList.add('bg-slate-900', 'text-slate-300');
            }, 2000);
        }

        function copyCode(btn) {
            const code = btn.previousElementSibling.innerText;
            const el = document.createElement('textarea');
            el.value = code;
            el.setAttribute('readonly', '');
            el.style.position = 'absolute';
            el.style.left = '-9999px';
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);

            const original = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check text-green-400"></i>';
            setTimeout(() => { btn.innerHTML = original; }, 2000);
        }
    </script>
</body>
</html>
